<div class="super-concept-delta">


  <div style="margin-top: 50px; margin-left: 40px; margin-bottom: 100px">
    <p class="fs-5 fw-bold" style="margin-bottom: 10px">PCE</p>




<!--    <p class="fw-bold" style="color: darkorchid; margin-bottom: 10px">PCE</p>-->

    <div *ngIf="!finishPreprocessingPce || !superConceptDeltaService.finishPreprocessingPce">
      <span class="spinner-border spinner-border-sm" role="status" [id]="'spinnerCandidates'" aria-hidden="true" style="margin-left: 30px; color: grey"></span>
      <p class="" style="margin-bottom: 10px; margin-top: -25px; margin-left: 55px; color: grey">Loading...</p>
    </div>


    <div *ngIf="finishPreprocessingPce || superConceptDeltaService.finishPreprocessingPce">

      <app-highlightingPce></app-highlightingPce>

      <p class="fs-5 fw-bold" style="margin-bottom: 20px; margin-top: 40px">Determine Super Concept and Delta</p>


      <p class="fw-bold" style="color: darkorchid; margin-bottom: 10px; margin-top: 20px">Super Concept Candidates</p>

      <div *ngIf="!finishSuperConceptCandidates">
        <span class="spinner-border spinner-border-sm" role="status" [id]="'spinnerCandidates'" aria-hidden="true" style="margin-left: 30px; color: grey"></span>
        <p class="" style="margin-bottom: 10px; margin-top: -25px; margin-left: 55px; color: grey">Loading...</p>
      </div>

      <div *ngIf="finishSuperConceptCandidates">
        <table class="table table-striped table-sm table-bordered" style="width: 1500px; margin-top: 15px">
          <tbody>
          <tr *ngFor="let v of superConceptCandidatesListPart1; let i = index">
            <td style="width: 700px">{{superConceptCandidatesListPart1[i]}}</td>
            <td style="width: 800px">{{superConceptCandidatesListPart2[i]}}</td>
          </tr>
          </tbody>
        </table>


        <p class="fw-bold" style="color: darkorchid; margin-bottom: 10px; margin-top: 20px">Super Concept</p>
        <div *ngIf="!finishSuperConcept">
          <span class="spinner-border spinner-border-sm" role="status" [id]="'spinnerSuperConcept'" aria-hidden="true" style="margin-left: 30px; color: grey"></span>
          <p class="" style="margin-bottom: 10px; margin-top: -25px; margin-left: 55px; color: grey">Loading...</p>
        </div>


        <div *ngIf="finishSuperConcept">
          <table class="table table-sm table-bordered" style="width: 1500px; margin-top: 15px">
            <thead>
            <tr>
              <th scope="col" style="width: 700px">Super Concept</th>
              <th scope="col" colspan="2">Attribute Relation</th>
            </tr>
            </thead>
            <tbody>
            <ng-container *ngFor="let v of superConceptAttributeList; let i = index">
              <tr style="background-color: #f2f2f2">
                <td [rowSpan]="getRowSpan(superConceptAttributeList)" *ngIf="i == 0">{{superConcept}}</td>
                <!--            <ng-container *ngFor="let v of superConceptAttributeList; let i = index">-->
                <td>{{superConceptAttributeList[i]}}</td>
                <td>{{superConceptValueList[i]}}</td>
                <!--            </ng-container>-->
              </tr>
            </ng-container>
            </tbody>
          </table>

          <p class="fw-bold" style="color: darkorchid; margin-bottom: 10px; margin-top: 20px">Delta</p>
          <div *ngIf="!finishDelta">
            <span class="spinner-border spinner-border-sm" role="status" [id]="'spinnerDelta'" aria-hidden="true" style="margin-left: 30px; color: grey"></span>
            <p class="" style="margin-bottom: 10px; margin-top: -25px; margin-left: 55px; color: grey">Loading...</p>
          </div>

          <div *ngIf="finishDelta">
            <table class="table table-sm  table-striped table-bordered" style="width: 1500px; margin-top: 15px">
              <thead>
              <tr>
                <th scope="col" style="width: 40px">RG</th>
                <th scope="col" style="width: 660px">Attribute</th>
                <th scope="col" >Value</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let v of deltaAttributeList; let i = index">
                <td>{{deltaIdRoleGroup[i]}}</td>
                <td>{{deltaAttributeList[i]}}</td>
                <td>{{deltaValueList[i]}}</td>
              </tr>
              </tbody>
            </table>

<!--            <p class="fs-5 fw-bold" style="margin-bottom: 20px; margin-top: 50px">Mapping to elements of FHIR resources</p>-->

            <div class="row">
              <div class="col">
                <p class="fs-5 fw-bold" style="margin-bottom: 20px; margin-top: 20px">Mapping to elements of FHIR resources
                  <label *ngIf="finishFhir" class="form-label" style="cursor: pointer; height: 45px; color: rebeccapurple" placement="right" data-bs-trigger="focus" [ngbPopover]="popContentInfo" >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-square" viewBox="0 0 16 16" style="margin-left: 50px; margin-top: -1px">
                      <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                      <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                  </label>
                  <label *ngIf="finishFhir" class="form-label" style="cursor: pointer; height: 45px; color: rebeccapurple" title="Copy to clipboard">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16" style="margin-left: 15px; margin-top: -1px" (click)="copyToClipboard()">
                      <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                      <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                    </svg>
                  </label>
                  <a *ngIf="finishFhir" download="pce-to-fhir.txt" title="Download" style="cursor: pointer; height: 45px; color: rebeccapurple" href="data:text/plain;charset=utf-16,{{result}}" (click)="download()">
                    <svg xmlns="http://www.w3.org/2000/svg" color="black" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16" style="margin-left: 15px; margin-top: -2px; color: rebeccapurple">
                      <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                      <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                    </svg>
                  </a>
                </p>
              </div>
              <div *ngIf="isCopyToClipboard" class="col" style="margin-top: 23px; max-height: 24px; min-height: 24px; margin-left: -450px">
                <div class="alert alert-secondary" style="max-width: 105px; max-height: 24px; display:inline-block; padding: 0px" role="alert"> Copied! </div>
              </div>
              <div *ngIf="isDownload" class="col" style="margin-top: 23px; max-height: 24px; min-height: 24px; margin-left: -450px">
                <div class="alert alert-secondary" style="max-width: 105px; max-height: 24px; display:inline-block; padding: 0px" role="alert"> Downloaded! </div>
              </div>
            </div>



            <ng-template #popContentInfo>
              <ng-container>
                Possible extensions from HL7 International are suggested in case a SNOMED CT element cannot be mapped. In a few cases it is possible that the super concept is not needed.
              </ng-container>
            </ng-template>

            <!--            <div class="container" style="width: 450px; margin-left: 100px">-->
              <div *ngIf="finishFhir" class="row" style="width: 450px; margin-top: -20px">
                <div class="col">
                  <input class="form-control form-control-sm" list="datalistOptionsXX" id="exampleDataList" style="width: 150px" (keydown)="onKeyDown($event)" placeholder="Source of profiles"  [(ngModel)]="nameProfile">
                  <datalist id="datalistOptionsXX" >
                    <option id="XXXC" *ngFor="let v of sourceProfile"> {{v}}</option>
                  </datalist>
                </div>
                <div class="col">
                  <div class="btn-group btn-sm" role="group" style="margin-bottom: 20px">
                    <input type="radio" class="btn-check" name="btnradio" id="btn-light" autocomplete="off" (click)="changeVersion('light')" checked>
                    <label class="btn btn-outline-secondary btn-sm" for="btn-light" style="width: 110px">Light Version</label>

                    <input type="radio" class="btn-check" name="btnradio" id="btn-full" autocomplete="off" (click)="changeVersion('full')">
                    <label class="btn btn-outline-secondary btn-sm" for="btn-full" style="width: 110px">Full Version</label>
                  </div>
                </div>
              </div>
<!--            </div>-->


            <div *ngIf="!finishFhir">
              <span class="spinner-border spinner-border-sm" role="status" [id]="'spinnerSuperConcept'" aria-hidden="true" style="margin-left: 30px; color: grey"></span>
              <p class="" style="margin-bottom: 10px; margin-top: -25px; margin-left: 55px; color: grey">Loading...</p>
            </div>
            <div *ngIf="finishFhir && nameProfile !== ''">
              <table class="table table-sm table-bordered" style="width: 1500px; margin-top: 15px; white-space: pre-line">
                <thead>
                <tr>
                  <th scope="col" style="width: 700px">SNOMED CT Concepts</th>
                  <th scope="col" style="width: 740px">FHIRPath</th>
                  <th scope="col" style="width: 60px">Priority</th>
                </tr>
                </thead>
                <tbody *ngIf="idLightFull == 'light'">
                  <ng-container *ngFor="let n of listSummaryNameFhirLight; let i = index">
                    <ng-container *ngIf="n === nameProfile">
                      <ng-container *ngFor="let n of superConceptListFhirFull; let j = index">
                        <ng-container *ngIf="j < superConceptListFhirFull.length/2">
                          <tr *ngIf="j % 2 == 1" style="background-color: #f6f6f6">
                            <td>{{superConceptListFhirFull[j]}}</td>
                            <td>{{getFhirPath(j, -1, 'superconcept')}}</td>
                            <td>
                              <div *ngIf="checkSwitch(i, -1, -1, 'full-superconcept')" class="form-check form-switch" style="margin-left: 10px">
                                <input [id]="'superconcept' + i" class="form-check-input" type="checkbox" role="switch"  (change)="clickCol(i, -1, -1, 'superconcept' + i)" [checked]="this.listSummaryFhirSuperconceptPrioFull[i]">
                              </div>
                            </td>
                          </tr>
                          <tr *ngIf="j % 2 == 0">
                            <td>{{superConceptListFhirFull[j]}}</td>
                            <td>{{getFhirPath(j, -1, 'superconcept')}}</td>
                            <td>
                              <div *ngIf="checkSwitch(i, -1, -1, 'full-superconcept')" class="form-check form-switch" style="margin-left: 10px">
                                <input [id]="'superconcept' + i" class="form-check-input" type="checkbox" role="switch"  (change)="clickCol(i, -1, -1, 'superconcept' + i)" [checked]="this.listSummaryFhirSuperconceptPrioFull[i]">
                              </div>
                            </td>
                          </tr>
                        </ng-container>
                      </ng-container>

                      <ng-container *ngFor="let v of listSummaryValueFhirLight[i]; let j = index">
                        <tr *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 1" style="background-color: #f6f6f6">
                          <td [rowSpan]="getRowSpan(listSummaryPathFhirLight[i][j])">{{listSummaryValueFhirLight[i][j]}}</td>
                          <td>{{listSummaryPathFhirLight[i][j][0]}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, j, 0, 'light-path')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="getId(i, j, 0, 'light')" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, 0, '', 'light')" [checked]="this.listSummaryFhirPrioLight[i][j][0]">
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 0">
                          <td [rowSpan]="getRowSpan(listSummaryPathFhirLight[i][j])" >{{listSummaryValueFhirLight[i][j]}}</td>
                          <td>{{listSummaryPathFhirLight[i][j][0]}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, j, 0, 'light-path')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="getId(i, j, 0, 'light')" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, 0, '', 'light')" [checked]="this.listSummaryFhirPrioLight[i][j][0]">
                            </div>
                          </td>
                        </tr>

                        <ng-container *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 1">
                          <tr *ngFor="let v of listSummaryPathFhirLight[i][j] | slice:1; let k = index" style="background-color: #f6f6f6">
                            <td>{{v}}</td>
                            <td>
                              <div *ngIf="checkSwitch(i, j, 0, 'light-path')" class="form-check form-switch" style="margin-left: 10px">
                                <input [id]="getId(i, j, k+1, 'light')" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, k+1, '', 'light')" [checked]="this.listSummaryFhirPrioLight[i][j][k+1]">
                              </div>
                            </td>
                          </tr>
                        </ng-container>
                        <ng-container *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 0">
                          <tr *ngFor="let v of listSummaryPathFhirLight[i][j] | slice:1; let k = index">
                            <td>{{v}}</td>
                            <td>
                              <div *ngIf="checkSwitch(i, j, 0, 'light-path')" class="form-check form-switch" style="margin-left: 10px">
                                <input [id]="getId(i, j, k+1, 'light')" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, k+1, '', 'light')" [checked]="this.listSummaryFhirPrioLight[i][j][k+1]">
                              </div>
                            </td>
                          </tr>
                        </ng-container>
                      </ng-container>

                    </ng-container>
                  </ng-container>
                </tbody>
                <tbody *ngIf="idLightFull == 'full'">
                <ng-container *ngFor="let n of listSummaryNameFhirFull; let i = index">
                  <ng-container *ngIf="n === nameProfile">
                    <ng-container *ngFor="let n of superConceptListFhirFull; let j = index">
                      <ng-container *ngIf="j < superConceptListFhirFull.length/2">
                        <tr *ngIf="j % 2 == 1" style="background-color: #f6f6f6">
                          <td>{{superConceptListFhirFull[j]}}</td>
                          <td>{{getFhirPath(j, -1, 'superconcept')}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, -1, -1, 'full-superconcept')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="'superconcept' + i" class="form-check-input" type="checkbox" role="switch"  (change)="clickCol(i, -1, -1, 'superconcept' + i)" [checked]="this.listSummaryFhirSuperconceptPrioFull[i]">
                            </div>
                          </td>
                        </tr>
                        <tr *ngIf="j % 2 == 0">
                          <td>{{superConceptListFhirFull[j]}}</td>
                          <td>{{getFhirPath(j, -1, 'superconcept')}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, -1, -1, 'full-superconcept')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="'superconcept' + i" class="form-check-input" type="checkbox" role="switch"  (change)="clickCol(i, -1, -1, 'superconcept' + i)" [checked]="this.listSummaryFhirSuperconceptPrioFull[i]">
                            </div>
                          </td>
                        </tr>
                      </ng-container>
                    </ng-container>
                    <ng-container *ngFor="let v of listSummaryValueFhirFull[i]; let j = index">
                      <tr *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 1" style="background-color: #f6f6f6">
                        <td [rowSpan]="getRowSpan(listSummaryPathFhirFull[i][j])">{{listSummaryValueFhirFull[i][j]}}</td>
                        <td>{{listSummaryPathFhirFull[i][j][0]}}</td>
                        <td>
                          <div *ngIf="checkSwitch(i, j, 0, 'full-path')" class="form-check form-switch" style="margin-left: 10px">
                            <input [id]="getId(i, j, 0)" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, 0)" [checked]="this.listSummaryFhirPrioFull[i][j][0]">
                          </div>
                        </td>
                      </tr>
                      <tr *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 0">
                        <td [rowSpan]="getRowSpan(listSummaryPathFhirFull[i][j])" >{{listSummaryValueFhirFull[i][j]}}</td>
<!--                        <td>{{listSummaryPathFhirFull[i][j][0]}}</td>-->
                        <td>{{listSummaryPathFhirFull[i][j]}}</td>
                        <td>
                          <div *ngIf="checkSwitch(i, j, 0, 'full-path')" class="form-check form-switch" style="margin-left: 10px">
                            <input [id]="getId(i, j, 0)" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, 0)" [checked]="this.listSummaryFhirPrioFull[i][j][0]">
                          </div>
                        </td>
                      </tr>

                      <ng-container *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 1">
                        <tr *ngFor="let v of listSummaryPathFhirFull[i][j] | slice:1; let k = index" style="background-color: #f6f6f6">
                          <td>{{v}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, j, 0, 'full-path')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="getId(i, j, k+1)" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, k+1)" [checked]="this.listSummaryFhirPrioFull[i][j][k+1]">
                            </div>
                          </td>
                        </tr>
                      </ng-container>
                      <ng-container *ngIf="(j + superConceptListFhirFull.length/2) % 2 == 0">
                        <tr *ngFor="let v of listSummaryPathFhirFull[i][j] | slice:1; let k = index">
                          <td>{{v}}</td>
                          <td>
                            <div *ngIf="checkSwitch(i, j, 0, 'full-path')" class="form-check form-switch" style="margin-left: 10px">
                              <input [id]="getId(i, j, k+1)" class="form-check-input" type="checkbox" role="switch" (change)="clickCol(i, j, k+1)" [checked]="this.listSummaryFhirPrioFull[i][j][k+1]">
                            </div>
                          </td>
                        </tr>
                      </ng-container>
                    </ng-container>
                  </ng-container>
                </ng-container>
                </tbody>
              </table>

              <p *ngIf="checkReferences()" class="fw-bold" style="color: darkorchid; margin-bottom: 10px; margin-top: 20px">References</p>
              <table *ngIf="checkReferences()" class="table table-sm  table-striped table-bordered" style="width: 1500px; margin-top: 15px; white-space: pre-line">
                <thead>
                  <tr>
                    <th scope="col"  style="width: 700px">Referenced resources</th>
                    <th scope="col"  style="width: 800px">FHIRPath</th>
                  </tr>
                </thead>
                <tbody *ngIf="idLightFull == 'full'">
                  <ng-container *ngFor="let n of listSummaryNameFhirFull; let i = index">
                    <ng-container *ngIf="n === nameProfile">
                      <tr *ngFor="let v of referencesListFhirFull[i]; let j = index">
                        <td>{{getFhirPathReferences(v, 1)}}</td>
                        <td>{{getFhirPathReferences(v, 0)}}</td>
                      </tr>
                    </ng-container>
                  </ng-container>
                </tbody>
                <tbody *ngIf="idLightFull == 'light'">
                <ng-container *ngFor="let n of listSummaryNameFhirLight; let i = index">
                  <ng-container *ngIf="n === nameProfile">
                    <tr *ngFor="let v of referencesListFhirLight[i]; let j = index">
                      <td>{{getFhirPathReferences(v, 1)}}</td>
                      <td>{{getFhirPathReferences(v, 0)}}</td>
                    </tr>
                  </ng-container>
                </ng-container>
                </tbody>
              </table>

              <p class="fw-bold" style="color: darkorchid; margin-bottom: 10px; margin-top: 20px">Names of Profiles</p>
              <table class="table table-sm  table-striped table-bordered" style="width: 1500px; margin-top: 15px; white-space: pre-line">
                <thead>
                <tr>
                  <th scope="col"  style="width: 700px">Resource</th>
                  <th scope="col"  style="width: 800px">Name of profile</th>
                </tr>
                </thead>
                  <tbody *ngIf="idLightFull == 'full'">
                  <ng-container *ngFor="let n of listSummaryNameFhirFull; let i = index">
                    <ng-container *ngIf="n === nameProfile">
                      <tr *ngFor="let v of namesListFhirFull[i]; let j = index">
                        <td>{{getFhirName(v, 0)}}</td>
                        <td>{{getFhirName(v, 1)}}</td>
                      </tr>
                    </ng-container>
                  </ng-container>
                  </tbody>
                <tbody *ngIf="idLightFull == 'light'">
                <ng-container *ngFor="let n of listSummaryNameFhirLight; let i = index">
                  <ng-container *ngIf="n === nameProfile">
                    <tr *ngFor="let v of namesListFhirFull[i]; let j = index">
                      <td>{{getFhirName(v, 0)}}</td>
                      <td>{{getFhirName(v, 1)}}</td>
                    </tr>
                  </ng-container>
                </ng-container>
                </tbody>
              </table>

            </div>



          </div>






          </div>





      </div>







    </div>


  </div>





</div>
